(function(c){var b={tagClass:function(j){return"label label-info"},focusClass:"focus",itemValue:function(j){return j?j.toString():j},itemText:function(j){return this.itemValue(j)},itemTitle:function(j){return null},freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:false,onTagExists:function(k,j){j.hide().fadeIn()},trimValue:false,allowDuplicates:false,triggerChange:true};function g(k,j){this.isInit=true;this.itemsArray=[];this.$element=c(k);this.$element.hide();this.isSelect=(k.tagName==="SELECT");this.multiple=(this.isSelect&&k.hasAttribute("multiple"));this.objectItems=j&&j.itemValue;this.placeholderText=k.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=c('<div class="bootstrap-tagsinput"></div>');this.$input=c('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.before(this.$container);this.build(j);this.isInit=false}g.prototype={constructor:g,add:function(w,s,z){var x=this;if(x.options.maxTags&&x.itemsArray.length>=x.options.maxTags){return}if(w!==false&&!w){return}if(typeof w==="string"&&x.options.trimValue){w=c.trim(w)}if(typeof w==="object"&&!x.objectItems){throw ("Can't add objects when itemValue option is not set")}if(w.toString().match(/^\s*$/)){return}if(x.isSelect&&!x.multiple&&x.itemsArray.length>0){x.remove(x.itemsArray[0])}if(typeof w==="string"&&this.$element[0].tagName==="INPUT"){var k=(x.options.delimiterRegex)?x.options.delimiterRegex:x.options.delimiter;var t=w.split(k);if(t.length>1){for(var q=0;q<t.length;q++){this.add(t[q],true)}if(!s){x.pushVal(x.options.triggerChange)}return}}var n=x.options.itemValue(w),v=x.options.itemText(w),p=x.options.tagClass(w),m=x.options.itemTitle(w);var l=c.grep(x.itemsArray,function(A){return x.options.itemValue(A)===n})[0];if(l&&!x.options.allowDuplicates){if(x.options.onTagExists){var o=c(".tag",x.$container).filter(function(){return c(this).data("item")===l});x.options.onTagExists(w,o)}return}if(x.items().toString().length+w.length+1>x.options.maxInputLength){return}var y=c.Event("beforeItemAdd",{item:w,cancel:false,options:z});x.$element.trigger(y);if(y.cancel){return}x.itemsArray.push(w);var r=c('<span class="tag '+f(p)+(m!==null?('" title="'+m):"")+'">'+f(v)+'<span data-role="remove"></span></span>');r.data("item",w);x.findInputWrapper().before(r);r.after(" ");var u=(c('option[value="'+encodeURIComponent(n)+'"]',x.$element).length||c('option[value="'+f(n)+'"]',x.$element).length);if(x.isSelect&&!u){var j=c("<option selected>"+f(v)+"</option>");j.data("item",w);j.attr("value",n);x.$element.append(j)}if(!s){x.pushVal(x.options.triggerChange)}if(x.options.maxTags===x.itemsArray.length||x.items().toString().length===x.options.maxInputLength){x.$container.addClass("bootstrap-tagsinput-max")}if(c(".typeahead, .twitter-typeahead",x.$container).length){x.$input.typeahead("val","")}if(this.isInit){x.$element.trigger(c.Event("itemAddedOnInit",{item:w,options:z}))}else{x.$element.trigger(c.Event("itemAdded",{item:w,options:z}))}},remove:function(l,m,k){var j=this;if(j.objectItems){if(typeof l==="object"){l=c.grep(j.itemsArray,function(o){return j.options.itemValue(o)==j.options.itemValue(l)})}else{l=c.grep(j.itemsArray,function(o){return j.options.itemValue(o)==l})}l=l[l.length-1]}if(l){var n=c.Event("beforeItemRemove",{item:l,cancel:false,options:k});j.$element.trigger(n);if(n.cancel){return}c(".tag",j.$container).filter(function(){return c(this).data("item")===l}).remove();c("option",j.$element).filter(function(){return c(this).data("item")===l}).remove();if(c.inArray(l,j.itemsArray)!==-1){j.itemsArray.splice(c.inArray(l,j.itemsArray),1)}}if(!m){j.pushVal(j.options.triggerChange)}if(j.options.maxTags>j.itemsArray.length){j.$container.removeClass("bootstrap-tagsinput-max")}j.$element.trigger(c.Event("itemRemoved",{item:l,options:k}))},removeAll:function(){var j=this;c(".tag",j.$container).remove();c("option",j.$element).remove();while(j.itemsArray.length>0){j.itemsArray.pop()}j.pushVal(j.options.triggerChange)},refresh:function(){var j=this;c(".tag",j.$container).each(function(){var l=c(this),n=l.data("item"),o=j.options.itemValue(n),k=j.options.itemText(n),p=j.options.tagClass(n);l.attr("class",null);l.addClass("tag "+f(p));l.contents().filter(function(){return this.nodeType==3})[0].nodeValue=f(k);if(j.isSelect){var m=c("option",j.$element).filter(function(){return c(this).data("item")===n});m.attr("value",o)}})},items:function(){return this.itemsArray},pushVal:function(){var j=this,k=c.map(j.items(),function(l){return j.options.itemValue(l).toString()});j.$element.val(k,true);if(j.options.triggerChange){j.$element.trigger("change")}},build:function(k){var j=this;j.options=c.extend({},b,k);if(j.objectItems){j.options.freeInput=false}a(j.options,"itemValue");a(j.options,"itemText");h(j.options,"tagClass");if(j.options.typeahead){var n=j.options.typeahead||{};h(n,"source");j.$input.typeahead(c.extend({},n,{source:function(r,t){function p(u){var w=[];for(var v=0;v<u.length;v++){var x=j.options.itemText(u[v]);s[x]=u[v];w.push(x)}t(w)}this.map={};var s=this.map,q=n.source(r);if(c.isFunction(q.success)){q.success(p)}else{if(c.isFunction(q.then)){q.then(p)}else{c.when(q).then(p)}}},updater:function(p){j.add(this.map[p]);return this.map[p]},matcher:function(p){return(p.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(p){return p.sort()},highlighter:function(q){var p=new RegExp("("+this.query+")","gi");return q.replace(p,"<strong>$1</strong>")}}))}if(j.options.typeaheadjs){var l=j.options.typeaheadjs;if(!c.isArray(l)){l=[null,l]}var m=l[1].valueKey;var o=m?function(p){return p[m]}:function(p){return p};c.fn.typeahead.apply(j.$input,l).on("typeahead:selected",c.proxy(function(q,p){j.add(o(p));j.$input.typeahead("val","")},j))}j.$container.on("click",c.proxy(function(p){if(!j.$element.attr("disabled")){j.$input.removeAttr("disabled")}j.$input.focus()},j));if(j.options.addOnBlur&&j.options.freeInput){j.$input.on("focusout",c.proxy(function(p){if(c(".typeahead, .twitter-typeahead",j.$container).length===0){j.add(j.$input.val());j.$input.val("")}},j))}j.$container.on({focusin:function(){j.$container.addClass(j.options.focusClass)},focusout:function(){j.$container.removeClass(j.options.focusClass)}});j.$container.on("keydown","input",c.proxy(function(p){var t=c(p.target),u=j.findInputWrapper();if(j.$element.attr("disabled")){j.$input.attr("disabled","disabled");return}switch(p.which){case 8:if(e(t[0])===0){var q=u.prev();if(q.length){j.remove(q.data("item"))}}break;case 46:if(e(t[0])===0){var r=u.next();if(r.length){j.remove(r.data("item"))}}break;case 37:var v=u.prev();if(t.val().length===0&&v[0]){v.before(u);t.focus()}break;case 39:var s=u.next();if(t.val().length===0&&s[0]){s.after(u);t.focus()}break;default:}var y=t.val().length,w=Math.ceil(y/5),x=y+w+1;t.attr("size",Math.max(this.inputSize,t.val().length))},j));j.$container.on("keypress","input",c.proxy(function(t){var v=c(t.target);if(j.$element.attr("disabled")){j.$input.attr("disabled","disabled");return}var u=v.val(),s=j.options.maxChars&&u.length>=j.options.maxChars;if(j.options.freeInput&&(d(t,j.options.confirmKeys)||s)){if(u.length!==0){j.add(s?u.substr(0,j.options.maxChars):u);v.val("")}if(j.options.cancelConfirmKeysOnEmpty===false){t.preventDefault()}}var r=v.val().length,q=Math.ceil(r/5),p=r+q+1;v.attr("size",Math.max(this.inputSize,v.val().length))},j));j.$container.on("click","[data-role=remove]",c.proxy(function(p){if(j.$element.attr("disabled")){return}j.remove(c(p.target).closest(".tag").data("item"))},j));if(j.$element[0].tagName==="INPUT"){j.add(j.$element.val())}else{c("option",j.$element).each(function(){var p=c(this).data("item")||{};p[k.itemText]=c(this).text();p[k.itemValue]=c(this).attr("value");j.add(p,true)})}},destroy:function(){var j=this;j.$container.off("keypress","input");j.$container.off("click","[role=remove]");j.$container.remove();j.$element.removeData("tagsinput");j.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var k=this.$input[0],j=this.$container[0];while(k&&k.parentNode!==j){k=k.parentNode}return c(k)}};c.fn.tagsinput=function(l,k,j){var m=[];this.each(function(){var o=c(this).data("tagsinput");if(!o){o=new g(this,l);c(this).data("tagsinput",o);m.push(o);if(this.tagName==="SELECT"){c("option",c(this)).attr("selected","selected")}c(this).val(c(this).val())}else{if(!l&&!k){m.push(o)}else{if(o[l]!==undefined){if(o[l].length===3&&j!==undefined){var n=o[l](k,null,j)}else{var n=o[l](k)}if(n!==undefined){m.push(n)}}}}});if(typeof l=="string"){return m.length>1?m:m[0]}else{return m}};c.fn.tagsinput.Constructor=g;function a(k,l){if(typeof k[l]!=="function"){var j=k[l];k[l]=function(m){return m[j]}}}function h(j,k){if(typeof j[k]!=="function"){var l=j[k];j[k]=function(){return l}}}var i=c("<div />");function f(j){if(j){return i.text(j).html()}else{return""}}function e(k){var l=0;if(document.selection){k.focus();var j=document.selection.createRange();j.moveStart("character",-k.value.length);l=j.text.length}else{if(k.selectionStart||k.selectionStart=="0"){l=k.selectionStart}}return(l)}function d(j,l){var k=false;c.each(l,function(o,n){if(typeof(n)==="number"&&j.which===n){k=true;return false}if(j.which===n.which){var q=!n.hasOwnProperty("altKey")||j.altKey===n.altKey,m=!n.hasOwnProperty("shiftKey")||j.shiftKey===n.shiftKey,p=!n.hasOwnProperty("ctrlKey")||j.ctrlKey===n.ctrlKey;if(q&&m&&p){k=true;return false}}});return k}c(function(){c("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);